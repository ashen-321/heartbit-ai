
Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:17 in <module>                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 14 [0m                                                                               [31m [0m
[31m [0m   [2m 15 [0m                                                                               [31m [0m
[31m [0m   [2m 16 [0m[2m# Variables and constants[0m                                                      [31m [0m
[31m [0m [31m❱ [0m 17 aoss_host = [1;4mread_key_value([0m[1;4;33m"[0m[1;4;33m.aoss_config.txt[0m[1;4;33m"[0m[1;4m, [0m[1;4;33m"[0m[1;4;33mAOSS_host_name[0m[1;4;33m"[0m[1;4m)[0m               [31m [0m
[31m [0m   [2m 18 [0maoss_index = read_key_value([33m"[0m[33m.aoss_config.txt[0m[33m"[0m, [33m"[0m[33mAOSS_index_name[0m[33m"[0m)             [31m [0m
[31m [0m   [2m 19 [0m                                                                               [31m [0m
[31m [0m   [2m 20 [0minput_file_path = os.path.join(os.path.dirname([91m__file__[0m), [33m"[0m[33minput-files[0m[33m"[0m)       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mutil.py[0m:11 in read_key_value          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 8 [0m                                                                                [31m [0m
[31m [0m   [2m 9 [0m[2m# Get AOSS key and values[0m                                                       [31m [0m
[31m [0m   [2m10 [0m[94mdef[0m[90m [0m[92mread_key_value[0m(file_path, key):                                             [31m [0m
[31m [0m [31m❱ [0m11 [2m│   [0m[94mwith[0m [1;4;96mopen[0m[1;4m(file_path, [0m[1;4;33m'[0m[1;4;33mr[0m[1;4;33m'[0m[1;4m)[0m [94mas[0m file:                                          [31m [0m
[31m [0m   [2m12 [0m[2m│   │   [0m[94mfor[0m line [95min[0m file:                                                       [31m [0m
[31m [0m   [2m13 [0m[2m│   │   │   [0mkey_value_pairs = line.strip().split([33m'[0m[33m:[0m[33m'[0m)                           [31m [0m
[31m [0m   [2m14 [0m[2m│   │   │   [0m[94mif[0m key_value_pairs[[94m0[0m] == key:                                       [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mFileNotFoundError: [0m[1m[[0mErrno [1;36m2[0m[1m][0m No such file or directory: [32m'.aoss_config.txt'[0m
  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:71 in <module>                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 68 [0m[2m│   │   │   [0mst.image(io.BytesIO(image_bytes))                                  [31m [0m
[31m [0m   [2m 69 [0m[2m│   │   │   [0m                                                                   [31m [0m
[31m [0m   [2m 70 [0m[2m│   │   │   [0minput_file = os.path.join(input_file_path, input_image_file + [33mf[0m[33m"[0m[33m_[0m[33m{[0m [31m [0m
[31m [0m [31m❱ [0m 71 [2m│   │   │   [0m[94mwith[0m [1;4;96mopen[0m[1;4m(input_file, [0m[1;4;33m'[0m[1;4;33mwb[0m[1;4;33m'[0m[1;4m)[0m [94mas[0m image_file:                         [31m [0m
[31m [0m   [2m 72 [0m[2m│   │   │   │   [0mimage_file.write(image_bytes)                                  [31m [0m
[31m [0m   [2m 73 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m 74 [0m[2m│   │   [0mlast_uploaded_files = upload_file                                      [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mFileNotFoundError: [0m[1m[[0mErrno [1;36m2[0m[1m][0m No such file or directory: 
[32m'./input-files/input_image_0.jpeg'[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:204 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m201 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m202 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m203 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m204 [2m│   [0mresponse = [1;4mopenai_generate(MODEL_ID, st.session_state.messages, max_tokens[0m [31m [0m
[31m [0m   [2m205 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m206 [0m[2m│   [0m[2m# Call tools and save results[0m                                              [31m [0m
[31m [0m   [2m207 [0m[2m│   [0mtool_calls = response.choices[[94m0[0m].message.tool_calls                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mutil.py[0m:58 in openai_generate         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m55 [0m[2m│   │   [0mbase_url=openai_api_base,                                               [31m [0m
[31m [0m   [2m56 [0m[2m│   [0m)                                                                           [31m [0m
[31m [0m   [2m57 [0m[2m│   [0m                                                                            [31m [0m
[31m [0m [31m❱ [0m58 [2m│   [0mchat_response = [1;4mclient.chat.completions.create([0m                             [31m [0m
[31m [0m   [2m59 [0m[2m│   │   [0m[1;4mmodel=model_id,[0m                                                         [31m [0m
[31m [0m   [2m60 [0m[2m│   │   [0m[1;4mmessages=[[0m                                                              [31m [0m
[31m [0m   [2m61 [0m[2m│   │   │   [0m[1;4m{[0m[1;4;33m"[0m[1;4;33mrole[0m[1;4;33m"[0m[1;4m: [0m[1;4;33m"[0m[1;4;33msystem[0m[1;4;33m"[0m[1;4m,[0m                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mNotFoundError: [0mError code: [1;36m404[0m - [1m{[0m[32m'object'[0m: [32m'error'[0m, [32m'message'[0m: [32m'The model [0m
[32m`alfredcs/gemma-3N-finetune` does not exist.'[0m, [32m'type'[0m: [32m'NotFoundError'[0m, [32m'param'[0m: [3;35mNone[0m, 
[32m'code'[0m: [1;36m404[0m[1m}[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:204 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m201 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m202 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m203 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m204 [2m│   [0mresponse = [1;4mopenai_generate(MODEL_ID, st.session_state.messages, max_tokens[0m [31m [0m
[31m [0m   [2m205 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m206 [0m[2m│   [0m[2m# Call tools and save results[0m                                              [31m [0m
[31m [0m   [2m207 [0m[2m│   [0mtool_calls = response.choices[[94m0[0m].message.tool_calls                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mutil.py[0m:58 in openai_generate         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m55 [0m[2m│   │   [0mbase_url=openai_api_base,                                               [31m [0m
[31m [0m   [2m56 [0m[2m│   [0m)                                                                           [31m [0m
[31m [0m   [2m57 [0m[2m│   [0m                                                                            [31m [0m
[31m [0m [31m❱ [0m58 [2m│   [0mchat_response = [1;4mclient.chat.completions.create([0m                             [31m [0m
[31m [0m   [2m59 [0m[2m│   │   [0m[1;4mmodel=model_id,[0m                                                         [31m [0m
[31m [0m   [2m60 [0m[2m│   │   [0m[1;4mmessages=[[0m                                                              [31m [0m
[31m [0m   [2m61 [0m[2m│   │   │   [0m[1;4m{[0m[1;4;33m"[0m[1;4;33mrole[0m[1;4;33m"[0m[1;4m: [0m[1;4;33m"[0m[1;4;33msystem[0m[1;4;33m"[0m[1;4m,[0m                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mBadRequestError: [0mError code: [1;36m400[0m - [1m{[0m[32m'object'[0m: [32m'error'[0m, [32m'message'[0m: [32m"8 validation errors [0m
[32mfor ValidatorIterator\n0.ChatCompletionContentPartTextParam.text\n  Field required [0m
[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and truthfully.'[0m[32m}[0m[32m, [0m
[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.ChatCompletionContentPartTextParam.type\n [0m
[32mField required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and [0m
[32mtruthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.ChatCompletionContentPartImageParam.image_[0m
[32murl\n  Field required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and [0m
[32mtruthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.ChatCompletionContentPartImageParam.type\n[0m
[32mField required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and [0m
[32mtruthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.ChatCompletionContentPartInputAudioParam.i[0m
[32mnput_audio\n  Field required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', [0m
[32m'conte...rately and truthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.ChatCompletionContentPartInputAudioParam.t[0m
[32mype\n  Field required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and [0m
[32mtruthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing\n0.File.file\n  Field required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m,[0m
[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and truthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    [0m
[32mFor further information visit https://errors.pydantic.dev/2.11/v/missing\n0.File.type\n [0m
[32mField required [0m[32m[[0m[32mtype[0m[32m=[0m[32mmissing[0m[32m, [0m[32minput_value[0m[32m=[0m[32m{[0m[32m'role': 'system', 'conte...rately and [0m
[32mtruthfully.'[0m[32m}[0m[32m, [0m[32minput_type[0m[32m=[0m[32mdict[0m[32m][0m[32m\n    For further information visit [0m
[32mhttps://errors.pydantic.dev/2.11/v/missing None"[0m, [32m'type'[0m: [32m'BadRequestError'[0m, [32m'param'[0m: 
[3;35mNone[0m, [32m'code'[0m: [1;36m400[0m[1m}[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:204 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m201 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m202 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m203 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m204 [2m│   [0mresponse = [1;4mopenai_generate(MODEL_ID, st.session_state.messages, max_tokens[0m [31m [0m
[31m [0m   [2m205 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m206 [0m[2m│   [0m[1;2;4m# Call tools and save results[0m                                              [31m [0m
[31m [0m   [2m207 [0m[2m│   [0m[1;4mtool_calls = response.choices[[0m[1;4;94m0[0m[1;4m].message.tool_calls[0m                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mNotFoundError: [0mError code: [1;36m404[0m - [1m{[0m[32m'object'[0m: [32m'error'[0m, [32m'message'[0m: [32m'The model [0m
[32m`alfredcs/torchrun-medgemma-27b-grpo-merged` does not exist.'[0m, [32m'type'[0m: [32m'NotFoundError'[0m, 
[32m'param'[0m: [3;35mNone[0m, [32m'code'[0m: [1;36m404[0m[1m}[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:215 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m212 [0m[2m│   [0mtool_calls = response.choices[[94m0[0m].message.tool_calls                        [31m [0m
[31m [0m   [2m213 [0m[2m│   [0m[94mif[0m [96mlen[0m(tool_calls):                                                        [31m [0m
[31m [0m   [2m214 [0m[2m│   │   [0m[94mfor[0m tool [95min[0m tool_calls:                                                [31m [0m
[31m [0m [31m❱ [0m215 [2m│   │   │   [0mresult = [1;4masyncio.run(call_tool(tool))[0m                              [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0mst.session_state.messages.append({[33m"[0m[33mrole[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: resul [31m [0m
[31m [0m   [2m217 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m218 [0m[2m│   [0m[2m# Get next response from LLM[0m                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:136 in call_tool              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m133 [0m[2m# Call tool[0m                                                                    [31m [0m
[31m [0m   [2m134 [0m[94masync[0m [94mdef[0m[90m [0m[92mcall_tool[0m(tool):                                                     [31m [0m
[31m [0m   [2m135 [0m[2m│   [0m[94masync[0m [94mwith[0m st.session_state[[33m"[0m[33mmcp_client[0m[33m"[0m] [94mas[0m mcp_client:                   [31m [0m
[31m [0m [31m❱ [0m136 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m mcp_client.call_tool(tool.function.name, tool.function.ar[0m [31m [0m
[31m [0m   [2m137 [0m                                                                               [31m [0m
[31m [0m   [2m138 [0m                                                                               [31m [0m
[31m [0m   [2m139 [0m[2m# ----------------------------------------------------------------------------[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:857 in call_tool                                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m854 [0m[2;33m│   │   │   [0m[33mToolError: If the tool call results in an error.[0m                   [31m [0m
[31m [0m   [2m855 [0m[2;33m│   │   │   [0m[33mRuntimeError: If called while the client is not connected.[0m         [31m [0m
[31m [0m   [2m856 [0m[2;33m│   │   [0m[33m"""[0m                                                                    [31m [0m
[31m [0m [31m❱ [0m857 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.call_tool_mcp([0m                                     [31m [0m
[31m [0m   [2m858 [0m[2m│   │   │   [0m[1;4mname=name,[0m                                                         [31m [0m
[31m [0m   [2m859 [0m[2m│   │   │   [0m[1;4marguments=arguments [0m[1;4;95mor[0m[1;4m {},[0m                                         [31m [0m
[31m [0m   [2m860 [0m[2m│   │   │   [0m[1;4mtimeout=timeout,[0m                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:818 in call_tool_mcp                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m815 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m816 [0m[2m│   │   [0m[94mif[0m [96misinstance[0m(timeout, [96mint[0m | [96mfloat[0m):                                   [31m [0m
[31m [0m   [2m817 [0m[2m│   │   │   [0mtimeout = datetime.timedelta(seconds=timeout)                      [31m [0m
[31m [0m [31m❱ [0m818 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.session.call_tool([0m                                 [31m [0m
[31m [0m   [2m819 [0m[2m│   │   │   [0m[1;4mname=name,[0m                                                         [31m [0m
[31m [0m   [2m820 [0m[2m│   │   │   [0m[1;4marguments=arguments,[0m                                               [31m [0m
[31m [0m   [2m821 [0m[2m│   │   │   [0m[1;4mread_timeout_seconds=timeout,[0m                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1msession[0m [31m [0m
[31m [0m [1m.py[0m:297 in call_tool                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m294 [0m[2m│   │   │   [0mtypes.ClientRequest(                                               [31m [0m
[31m [0m   [2m295 [0m[2m│   │   │   │   [0mtypes.CallToolRequest(                                         [31m [0m
[31m [0m   [2m296 [0m[2m│   │   │   │   │   [0mmethod=[33m"[0m[33mtools/call[0m[33m"[0m,                                       [31m [0m
[31m [0m [31m❱ [0m297 [2m│   │   │   │   │   [0mparams=[1;4mtypes.CallToolRequestParams([0m                        [31m [0m
[31m [0m   [2m298 [0m[2m│   │   │   │   │   │   [0m[1;4mname=name,[0m                                             [31m [0m
[31m [0m   [2m299 [0m[2m│   │   │   │   │   │   [0m[1;4marguments=arguments,[0m                                   [31m [0m
[31m [0m   [2m300 [0m[2m│   │   │   │   │   [0m[1;4m)[0m,                                                         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/pydantic/[0m[1mmain.py[0m:2 [31m [0m
[31m [0m 53 in __init__                                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 250 [0m[2;33m│   │   [0m[33m"""[0m                                                                   [31m [0m
[31m [0m   [2m 251 [0m[2m│   │   [0m[2m# `__tracebackhide__` tells pytest and some other tools to omit this [0m [31m [0m
[31m [0m   [2m 252 [0m[2m│   │   [0m__tracebackhide__ = [94mTrue[0m                                              [31m [0m
[31m [0m [31m❱ [0m 253 [2m│   │   [0mvalidated_self = [1;4;96mself[0m[1;4m.__pydantic_validator__.validate_python(data, se[0m [31m [0m
[31m [0m   [2m 254 [0m[2m│   │   [0m[94mif[0m [96mself[0m [95mis[0m [95mnot[0m validated_self:                                        [31m [0m
[31m [0m   [2m 255 [0m[2m│   │   │   [0mwarnings.warn(                                                    [31m [0m
[31m [0m   [2m 256 [0m[2m│   │   │   │   [0m[33m'[0m[33mA custom validator is returning a value other than `self`.[0m[33m\n[0m [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mValidationError: [0m[1;36m1[0m validation error for CallToolRequestParams
arguments
  Input should be a valid dictionary [1m[[0m[33mtype[0m=[35mdict_type[0m, [33minput_value[0m=[32m'[0m[32m{[0m[32m"query": "Search [0m
[32mmedRxi...ations on this topic."[0m[32m}[0m[32m'[0m, [33minput_type[0m=[35mstr[0m[1m][0m
    For further information visit [4;94mhttps://errors.pydantic.dev/2.11/v/dict_type[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:216 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m213 [0m[2m│   [0m[94mif[0m [96mlen[0m(tool_calls):                                                        [31m [0m
[31m [0m   [2m214 [0m[2m│   │   [0m[94mfor[0m tool [95min[0m tool_calls:                                                [31m [0m
[31m [0m   [2m215 [0m[2m│   │   │   [0mresult = asyncio.run(call_tool(tool))                              [31m [0m
[31m [0m [31m❱ [0m216 [2m│   │   │   [0mst.sessio[1;4mn_state.messages.append({[0m[1;4;33m"[0m[1;4;33mro[0m[33mle[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: resul [31m [0m
[31m [0m   [2m217 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m218 [0m[2m│   │   [0m[2m# Get next response from LLM[0m                                           [31m [0m
[31m [0m   [2m219 [0m[2m│   │   [0mresponse = st.session_state.openai_client.chat.completions.create(     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:136 in call_tool              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m133 [0m[2m# Call tool[0m                                                                    [31m [0m
[31m [0m   [2m134 [0m[94masync[0m [94mdef[0m[90m [0m[92mcall_tool[0m(tool):                                                     [31m [0m
[31m [0m   [2m135 [0m[2m│   [0m[94masync[0m [94mwith[0m st.session_state.mcp_client [94mas[0m mcp_client:                      [31m [0m
[31m [0m [31m❱ [0m136 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m mcp_client.call_tool(tool.function.name, tool.function.ar[0m [31m [0m
[31m [0m   [2m137 [0m                                                                               [31m [0m
[31m [0m   [2m138 [0m                                                                               [31m [0m
[31m [0m   [2m139 [0m[2m# ----------------------------------------------------------------------------[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:857 in call_tool                                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m854 [0m[2;33m│   │   │   [0m[33mToolError: If the tool call results in an error.[0m                   [31m [0m
[31m [0m   [2m855 [0m[2;33m│   │   │   [0m[33mRuntimeError: If called while the client is not connected.[0m         [31m [0m
[31m [0m   [2m856 [0m[2;33m│   │   [0m[33m"""[0m                                                                    [31m [0m
[31m [0m [31m❱ [0m857 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.call_tool_mcp([0m                                     [31m [0m
[31m [0m   [2m858 [0m[2m│   │   │   [0m[1;4mname=name,[0m                                                         [31m [0m
[31m [0m   [2m859 [0m[2m│   │   │   [0m[1;4marguments=arguments [0m[1;4;95mor[0m[1;4m {},[0m                                         [31m [0m
[31m [0m   [2m860 [0m[2m│   │   │   [0m[1;4mtimeout=timeout,[0m                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:818 in call_tool_mcp                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m815 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m816 [0m[2m│   │   [0m[94mif[0m [96misinstance[0m(timeout, [96mint[0m | [96mfloat[0m):                                   [31m [0m
[31m [0m   [2m817 [0m[2m│   │   │   [0mtimeout = datetime.timedelta(seconds=timeout)                      [31m [0m
[31m [0m [31m❱ [0m818 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.session.call_tool([0m                                 [31m [0m
[31m [0m   [2m819 [0m[2m│   │   │   [0m[1;4mname=name,[0m                                                         [31m [0m
[31m [0m   [2m820 [0m[2m│   │   │   [0m[1;4marguments=arguments,[0m                                               [31m [0m
[31m [0m   [2m821 [0m[2m│   │   │   [0m[1;4mread_timeout_seconds=timeout,[0m                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1msession[0m [31m [0m
[31m [0m [1m.py[0m:297 in call_tool                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m294 [0m[2m│   │   │   [0mtypes.ClientRequest(                                               [31m [0m
[31m [0m   [2m295 [0m[2m│   │   │   │   [0mtypes.CallToolRequest(                                         [31m [0m
[31m [0m   [2m296 [0m[2m│   │   │   │   │   [0mmethod=[33m"[0m[33mtools/call[0m[33m"[0m,                                       [31m [0m
[31m [0m [31m❱ [0m297 [2m│   │   │   │   │   [0mparams=[1;4mtypes.CallToolRequestParams([0m                        [31m [0m
[31m [0m   [2m298 [0m[2m│   │   │   │   │   │   [0m[1;4mname=name,[0m                                             [31m [0m
[31m [0m   [2m299 [0m[2m│   │   │   │   │   │   [0m[1;4marguments=arguments,[0m                                   [31m [0m
[31m [0m   [2m300 [0m[2m│   │   │   │   │   [0m[1;4m)[0m,                                                         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/pydantic/[0m[1mmain.py[0m:2 [31m [0m
[31m [0m 53 in __init__                                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 250 [0m[2;33m│   │   [0m[33m"""[0m                                                                   [31m [0m
[31m [0m   [2m 251 [0m[2m│   │   [0m[2m# `__tracebackhide__` tells pytest and some other tools to omit this [0m [31m [0m
[31m [0m   [2m 252 [0m[2m│   │   [0m__tracebackhide__ = [94mTrue[0m                                              [31m [0m
[31m [0m [31m❱ [0m 253 [2m│   │   [0mvalidated_self = [1;4;96mself[0m[1;4m.__pydantic_validator__.validate_python(data, se[0m [31m [0m
[31m [0m   [2m 254 [0m[2m│   │   [0m[94mif[0m [96mself[0m [95mis[0m [95mnot[0m validated_self:                                        [31m [0m
[31m [0m   [2m 255 [0m[2m│   │   │   [0mwarnings.warn(                                                    [31m [0m
[31m [0m   [2m 256 [0m[2m│   │   │   │   [0m[33m'[0m[33mA custom validator is returning a value other than `self`.[0m[33m\n[0m [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mValidationError: [0m[1;36m1[0m validation error for CallToolRequestParams
arguments
  Input should be a valid dictionary [1m[[0m[33mtype[0m=[35mdict_type[0m, [33minput_value[0m=[32m'[0m[32m{[0m[32m"query": "Search [0m
[32mmedRxi... recent publications."[0m[32m}[0m[32m'[0m, [33minput_type[0m=[35mstr[0m[1m][0m
    For further information visit [4;94mhttps://errors.pydantic.dev/2.11/v/dict_type[0m
  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:467 in _session_runner                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m464 [0m[2;33m│   │   [0m[33m"""[0m                                                                    [31m [0m
[31m [0m   [2m465 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m   [2m466 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m AsyncExitStack() [94mas[0m stack:                              [31m [0m
[31m [0m [31m❱ [0m467 [2m│   │   │   │   [0m[94mawait[0m stack.enter_async_context([96mself[0m._context_manager())       [31m [0m
[31m [0m   [2m468 [0m[2m│   │   │   │   [0m[2m# Session/context is now ready[0m                                 [31m [0m
[31m [0m   [2m469 [0m[2m│   │   │   │   [0m[96mself[0m._session_state.ready_event.set()                          [31m [0m
[31m [0m   [2m470 [0m[2m│   │   │   │   [0m[2m# Wait until disconnect/stop is requested[0m                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:668 in             [31m [0m
[31m [0m enter_async_context                                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m665 [0m[2m│   │   │   [0m[94mraise[0m [96mTypeError[0m([33mf[0m[33m"[0m[33m'[0m[33m{[0m[96mcls[0m.[91m__module__[0m[33m}[0m[33m.[0m[33m{[0m[96mcls[0m.[91m__qualname__[0m[33m}[0m[33m'[0m[33m object doe[0m [31m [0m
[31m [0m   [2m666 [0m[2m│   │   │   │   │   │   │   [0m[33mf[0m[33m"[0m[33mnot support the asynchronous context manager pro[0m [31m [0m
[31m [0m   [2m667 [0m[2m│   │   │   │   │   │      [0m) [94mfrom[0m[90m [0m[94mNone[0m                                         [31m [0m
[31m [0m [31m❱ [0m668 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m _enter(cm)[0m                                              [31m [0m
[31m [0m   [2m669 [0m[2m│   │   [0m[96mself[0m._push_async_cm_exit(cm, _exit)                                    [31m [0m
[31m [0m   [2m670 [0m[2m│   │   [0m[94mreturn[0m result                                                          [31m [0m
[31m [0m   [2m671 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:341 in _context_manager                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m338 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m339 [0m[2m│   [0m[1;95m@asynccontextmanager[0m                                                       [31m [0m
[31m [0m   [2m340 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m_context_manager[0m([96mself[0m):                                          [31m [0m
[31m [0m [31m❱ [0m341 [2m│   │   [0m[94mwith[0m [1;4mcatch(get_catch_handlers())[0m:                                      [31m [0m
[31m [0m   [2m342 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m [96mself[0m.transport.connect_session(                         [31m [0m
[31m [0m   [2m343 [0m[2m│   │   │   │   [0m**[96mself[0m._session_kwargs                                         [31m [0m
[31m [0m   [2m344 [0m[2m│   │   │   [0m) [94mas[0m session:                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:39 in __exit__                                                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 36 [0m[2m│   │   │   [0m[94melse[0m:                                                              [31m [0m
[31m [0m   [2m 37 [0m[2m│   │   │   │   [0m[94mif[0m [96misinstance[0m(exc, BaseExceptionGroup):                        [31m [0m
[31m [0m   [2m 38 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m 39 [2m│   │   │   │   │   │   [0m[94mraise[0m unhandled [94mfrom[0m[90m [0m[4;96mexc[0m[4;96m.[0m[4;96m__cause__[0m                     [31m [0m
[31m [0m   [2m 40 [0m[2m│   │   │   │   │   [0m[1;4;94mexcept[0m[1;4m BaseExceptionGroup:[0m                                 [31m [0m
[31m [0m   [2m 41 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# Change __context__ to __cause__ because Python 3.11 [0m [31m [0m
[31m [0m   [2m 42 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# too[0m                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:65 in handle_exception                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 62 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m   [2m 63 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m matched                                          [31m [0m
[31m [0m   [2m 64 [0m[2m│   │   │   │   │   [0m[94mexcept[0m BaseExceptionGroup:                                 [31m [0m
[31m [0m [31m❱ [0m 65 [2m│   │   │   │   │   │   [0mresult = handler(matched)                              [31m [0m
[31m [0m   [2m 66 [0m[2m│   │   │   │   [0m[94mexcept[0m BaseExceptionGroup [94mas[0m new_exc:                          [31m [0m
[31m [0m   [2m 67 [0m[2m│   │   │   │   │   [0m[94mif[0m new_exc [95mis[0m matched:                                     [31m [0m
[31m [0m   [2m 68 [0m[2m│   │   │   │   │   │   [0mnew_exceptions.append(new_exc)                         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/utilities/[0m [31m [0m
[31m [0m [1mexceptions.py[0m:29 in _exception_handler                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m26 [0m[2m│   │   │   │   │   [0mmessage=[33m"[0m[33mTimed out while waiting for response.[0m[33m"[0m,            [31m [0m
[31m [0m   [2m27 [0m[2m│   │   │   │   [0m)                                                               [31m [0m
[31m [0m   [2m28 [0m[2m│   │   │   [0m)                                                                   [31m [0m
[31m [0m [31m❱ [0m29 [2m│   │   [0m[1;4;94mraise[0m[1;4m leaf[0m                                                              [31m [0m
[31m [0m   [2m30 [0m                                                                                [31m [0m
[31m [0m   [2m31 [0m                                                                                [31m [0m
[31m [0m   [2m32 [0m[2m# this catch handler is used to catch taskgroup exception groups and raise the[0m  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:405 in handle_request_async                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m402 [0m[2m│   │   │   │   │   │   [0m[94mif[0m is_resumption:                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   │   [0m[94mawait[0m [96mself[0m._handle_resumption_request(ctx)         [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   │   [0m[94melse[0m:                                                  [31m [0m
[31m [0m [31m❱ [0m405 [2m│   │   │   │   │   │   │   [0m[1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._handle_post_request(ctx)[0m               [31m [0m
[31m [0m   [2m406 [0m[2m│   │   │   │   │   [0m                                                           [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   [0m[2m# If this is a request, start a new task to handle it[0m      [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(message.root, JSONRPCRequest):               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:259 in _handle_post_request                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m256 [0m[2m│   │   [0mmessage = ctx.session_message.message                                  [31m [0m
[31m [0m   [2m257 [0m[2m│   │   [0mis_initialization = [96mself[0m._is_initialization_request(message)           [31m [0m
[31m [0m   [2m258 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m259 [2m│   │   [0m[94masync[0m [94mwith[0m [1;4mctx.client.stream([0m                                          [31m [0m
[31m [0m   [2m260 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33mPOST[0m[1;4;33m"[0m[1;4m,[0m                                                            [31m [0m
[31m [0m   [2m261 [0m[2m│   │   │   [0m[1;4;96mself[0m[1;4m.url,[0m                                                          [31m [0m
[31m [0m   [2m262 [0m[2m│   │   │   [0m[1;4mjson=message.model_dump(by_alias=[0m[1;4;94mTrue[0m[1;4m, mode=[0m[1;4;33m"[0m[1;4;33mjson[0m[1;4;33m"[0m[1;4m, exclude_none=[0m[1;4;94mT[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 583 in stream                                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1580 [0m[2m│   │   │   [0mtimeout=timeout,                                                  [31m [0m
[31m [0m   [2m1581 [0m[2m│   │   │   [0mextensions=extensions,                                            [31m [0m
[31m [0m   [2m1582 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1583 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.send([0m                                           [31m [0m
[31m [0m   [2m1584 [0m[2m│   │   │   [0m[1;4mrequest=request,[0m                                                  [31m [0m
[31m [0m   [2m1585 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1586 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 629 in send                                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1626 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1627 [0m[2m│   │   [0mauth = [96mself[0m._build_request_auth(request, auth)                        [31m [0m
[31m [0m   [2m1628 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m1629 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_handling_auth([0m                            [31m [0m
[31m [0m   [2m1630 [0m[2m│   │   │   [0m[1;4mrequest,[0m                                                          [31m [0m
[31m [0m   [2m1631 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1632 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 657 in _send_handling_auth                                                           [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1654 [0m[2m│   │   │   [0mrequest = [94mawait[0m auth_flow.[92m__anext__[0m()                             [31m [0m
[31m [0m   [2m1655 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1656 [0m[2m│   │   │   [0m[94mwhile[0m [94mTrue[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m1657 [2m│   │   │   │   [0mresponse = [94mawait[0m [96mself[0m._send_handling_redirects(               [31m [0m
[31m [0m   [2m1658 [0m[2m│   │   │   │   │   [0mrequest,                                                  [31m [0m
[31m [0m   [2m1659 [0m[2m│   │   │   │   │   [0mfollow_redirects=follow_redirects,                        [31m [0m
[31m [0m   [2m1660 [0m[2m│   │   │   │   │   [0mhistory=history,                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 694 in _send_handling_redirects                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1691 [0m[2m│   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mrequest[0m[33m"[0m]:                         [31m [0m
[31m [0m   [2m1692 [0m[2m│   │   │   │   [0m[94mawait[0m hook(request)                                           [31m [0m
[31m [0m   [2m1693 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m [31m❱ [0m1694 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_single_request(request)[0m               [31m [0m
[31m [0m   [2m1695 [0m[2m│   │   │   [0m[94mtry[0m:                                                              [31m [0m
[31m [0m   [2m1696 [0m[2m│   │   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mresponse[0m[33m"[0m]:                    [31m [0m
[31m [0m   [2m1697 [0m[2m│   │   │   │   │   [0m[94mawait[0m hook(response)                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 730 in _send_single_request                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1727 [0m[2m│   │   │   [0m)                                                                 [31m [0m
[31m [0m   [2m1728 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1729 [0m[2m│   │   [0m[94mwith[0m request_context(request=request):                                [31m [0m
[31m [0m [31m❱ [0m1730 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m transport.handle_async_request(request)[0m          [31m [0m
[31m [0m   [2m1731 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1732 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(response.stream, AsyncByteStream)                   [31m [0m
[31m [0m   [2m1733 [0m[2m│   │   [0mresponse.request = request                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:393 in handle_async_request                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m390 [0m[2m│   │   │   [0mcontent=request.stream,                                            [31m [0m
[31m [0m   [2m391 [0m[2m│   │   │   [0mextensions=request.extensions,                                     [31m [0m
[31m [0m   [2m392 [0m[2m│   │   [0m)                                                                      [31m [0m
[31m [0m [31m❱ [0m393 [2m│   │   [0m[94mwith[0m [1;4mmap_httpcore_exceptions()[0m:                                        [31m [0m
[31m [0m   [2m394 [0m[2m│   │   │   [0mresp = [94mawait[0m [96mself[0m._pool.handle_async_request(req)                  [31m [0m
[31m [0m   [2m395 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m396 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(resp.stream, typing.AsyncIterable)                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:162 in __exit__    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m159 [0m[2m│   │   │   │   [0m[2m# tell if we get the same exception back[0m                       [31m [0m
[31m [0m   [2m160 [0m[2m│   │   │   │   [0mvalue = typ()                                                  [31m [0m
[31m [0m   [2m161 [0m[2m│   │   │   [0m[94mtry[0m:                                                               [31m [0m
[31m [0m [31m❱ [0m162 [2m│   │   │   │   [0m[96mself[0m.gen.throw(value)                                          [31m [0m
[31m [0m   [2m163 [0m[2m│   │   │   [0m[94mexcept[0m [96mStopIteration[0m [94mas[0m exc:                                       [31m [0m
[31m [0m   [2m164 [0m[2m│   │   │   │   [0m[2m# Suppress StopIteration *unless* it's the same exception that[0m [31m [0m
[31m [0m   [2m165 [0m[2m│   │   │   │   [0m[2m# was passed to throw().  This prevents a StopIteration[0m        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:118 in map_httpcore_exceptions                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   │   [0m[94mraise[0m                                                              [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0mmessage = [96mstr[0m(exc)                                                     [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   [0m[1;4;94mraise[0m[1;4m mapped_exc(message) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexc[0m                                     [31m [0m
[31m [0m   [2m119 [0m                                                                               [31m [0m
[31m [0m   [2m120 [0m                                                                               [31m [0m
[31m [0m   [2m121 [0m[94mclass[0m[90m [0m[4;92mResponseStream[0m(SyncByteStream):                                          [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mConnectError: [0mAll connection attempts failed

[3mThe above exception was the direct cause of the following exception:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:112 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m109 [0m[2m# Get tools[0m                                                                    [31m [0m
[31m [0m   [2m110 [0m[94masync[0m [94mdef[0m[90m [0m[92mget_tools[0m():                                                         [31m [0m
[31m [0m   [2m111 [0m[2m│   [0m[94mtry[0m:                                                                       [31m [0m
[31m [0m [31m❱ [0m112 [2m│   │   [0m[94masync[0m [94mwith[0m st.session_state.mcp_client [94mas[0m mcp_client:                  [31m [0m
[31m [0m   [2m113 [0m[2m│   │   │   [0mtools_list = [94mawait[0m mcp_client.list_tools()                         [31m [0m
[31m [0m   [2m114 [0m[2m│   │   │   [0m                                                                   [31m [0m
[31m [0m   [2m115 [0m[2m│   │   │   [0m[94mreturn[0m [96mlist[0m([96mmap[0m(tool_reformat, tools_list))                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:362 in __aenter__                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m359 [0m[2m│   │   │   │   │   [0m[96mself[0m._session_state.initialize_result = [94mNone[0m               [31m [0m
[31m [0m   [2m360 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m361 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aenter__[0m([96mself[0m):                                                [31m [0m
[31m [0m [31m❱ [0m362 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._connect()[0m                                           [31m [0m
[31m [0m   [2m363 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m364 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aexit__[0m([96mself[0m, exc_type, exc_val, exc_tb):                      [31m [0m
[31m [0m   [2m365 [0m[2m│   │   [0m[94mawait[0m [96mself[0m._disconnect()                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:406 in _connect                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   [0m)                                                      [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(exception, httpx.HTTPStatusError):           [31m [0m
[31m [0m   [2m405 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m exception                                        [31m [0m
[31m [0m [31m❱ [0m406 [2m│   │   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m                                        [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   │   [0m[1;4;33mf[0m[1;4;33m"[0m[1;4;33mClient failed to connect: [0m[1;4;33m{[0m[1;4mexception[0m[1;4;33m}[0m[1;4;33m"[0m               [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexception[0m                                           [31m [0m
[31m [0m   [2m409 [0m                                                                               [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mClient failed to connect: All connection attempts failed

[3mDuring handling of the above exception, another exception occurred:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:174 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m171 [0m[2m│   │   [0mprompt = voice_prompt                                                  [31m [0m
[31m [0m   [2m172 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m173 [0m[2m│   [0m[2m# Get tools[0m                                                                [31m [0m
[31m [0m [31m❱ [0m174 [2m│   [0mtools = [1;4masyncio.run(get_tools())[0m                                           [31m [0m
[31m [0m   [2m175 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m176 [0m[2m│   [0m[2m# Add relevant files to message content[0m                                    [31m [0m
[31m [0m   [2m177 [0m[2m│   [0mmessage_content = []                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:117 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m114 [0m[2m│   │   │   [0m                                                                   [31m [0m
[31m [0m   [2m115 [0m[2m│   │   │   [0m[94mreturn[0m [96mlist[0m([96mmap[0m(tool_reformat, tools_list))                        [31m [0m
[31m [0m   [2m116 [0m[2m│   [0m[94mexcept[0m [96mRuntimeError[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m117 [2m│   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m'[0m[1;4;33mEnsure master_mcp_server.py is running before star[0m [31m [0m
[31m [0m   [2m118 [0m                                                                               [31m [0m
[31m [0m   [2m119 [0m                                                                               [31m [0m
[31m [0m   [2m120 [0m[2m# Reformat FastMCP tools to OpenAI standard[0m                                    [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mEnsure master_mcp_server.py is running before starting the chatbot.
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:221 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m218 [0m[2m│   [0mtool_calls = response.choices[[94m0[0m].message.tool_calls                        [31m [0m
[31m [0m   [2m219 [0m[2m│   [0m[94mif[0m [96mlen[0m(tool_calls):                                                        [31m [0m
[31m [0m   [2m220 [0m[2m│   │   [0m[94mfor[0m tool [95min[0m tool_calls:                                                [31m [0m
[31m [0m [31m❱ [0m221 [2m│   │   │   [0mresult = [1;4masyncio.run(call_tool(tool))[0m                              [31m [0m
[31m [0m   [2m222 [0m[2m│   │   │   [0mst.session_state.messages.append({[33m"[0m[33mrole[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: resul [31m [0m
[31m [0m   [2m223 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m224 [0m[2m│   │   [0m[2m# Get next response from LLM[0m                                           [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:142 in call_tool              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m139 [0m[2m│   │   [0m[94melse[0m:                                                                  [31m [0m
[31m [0m   [2m140 [0m[2m│   │   │   [0margs = tool.function.arguments                                     [31m [0m
[31m [0m   [2m141 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m142 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m mcp_client.call_tool(tool.function.name, args)[0m            [31m [0m
[31m [0m   [2m143 [0m                                                                               [31m [0m
[31m [0m   [2m144 [0m                                                                               [31m [0m
[31m [0m   [2m145 [0m[2m# ----------------------------------------------------------------------------[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:866 in call_tool                                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m863 [0m[2m│   │   [0mdata = [94mNone[0m                                                            [31m [0m
[31m [0m   [2m864 [0m[2m│   │   [0m[94mif[0m result.isError [95mand[0m raise_on_error:                                  [31m [0m
[31m [0m   [2m865 [0m[2m│   │   │   [0mmsg = cast(mcp.types.TextContent, result.content[[94m0[0m]).text          [31m [0m
[31m [0m [31m❱ [0m866 [2m│   │   │   [0m[1;4;94mraise[0m[1;4m ToolError(msg)[0m                                               [31m [0m
[31m [0m   [2m867 [0m[2m│   │   [0m[94melif[0m result.structuredContent:                                         [31m [0m
[31m [0m   [2m868 [0m[2m│   │   │   [0m[94mtry[0m:                                                               [31m [0m
[31m [0m   [2m869 [0m[2m│   │   │   │   [0m[94mif[0m name [95mnot[0m [95min[0m [96mself[0m.session._tool_output_schemas:              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mToolError: [0mError calling tool [32m'access_sub_mcp'[0m: Recursion limit of [1;36m30[0m reached without 
hitting a stop condition. You can increase the limit by setting the `recursion_limit` 
config key.
For troubleshooting, visit: 
[4;94mhttps://python.langchain.com/docs/troubleshooting/errors/GRAPH_RECURSION_LIMIT[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:224 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m221 [0m[2m│   │   │   [0mresult = asyncio.run(call_tool(tool))                              [31m [0m
[31m [0m   [2m222 [0m[2m│   │   │   [0mst.session_state.messages.append({[33m"[0m[33mrole[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: resul [31m [0m
[31m [0m   [2m223 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m224 [2m│   │  [0m[1;2;4m [0m[1;2;4m# Get next res[0m[2mponse from LLM[0m                                           [31m [0m
[31m [0m   [2m225 [0m[2m│   │   [0mresponse = st.session_state.openai_client.chat.completions.create(     [31m [0m
[31m [0m   [2m226 [0m[2m│   │   │   [0mmodel=MODEL_ID,                                                    [31m [0m
[31m [0m   [2m227 [0m[2m│   │   │   [0mmessages=st.session_state.messages,                                [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mTypeError: [0mobject of type [32m'NoneType'[0m has no [1;35mlen[0m[1m([0m[1m)[0m
  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:10 in <module>                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m  7 [0m[94mimport[0m[90m [0m[4;96mdatetime[0m                                                                [31m [0m
[31m [0m   [2m  8 [0m[94mimport[0m[90m [0m[4;96mjson[0m                                                                    [31m [0m
[31m [0m   [2m  9 [0m[94mimport[0m[90m [0m[4;96mrandom[0m                                                                  [31m [0m
[31m [0m [31m❱ [0m 10 [1;4;94mimport[0m[1;4;90m [0m[1;4;96mmagic[0m                                                                   [31m [0m
[31m [0m   [2m 11 [0m[94mfrom[0m[90m [0m[4;96mPIL[0m[90m [0m[94mimport[0m Image                                                          [31m [0m
[31m [0m   [2m 12 [0m[94mfrom[0m[90m [0m[4;96mio[0m[90m [0m[94mimport[0m BytesIO                                                         [31m [0m
[31m [0m   [2m 13 [0m[94mimport[0m[90m [0m[4;96mbase64[0m                                                                  [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mModuleNotFoundError: [0mNo module named [32m'magic'[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:467 in _session_runner                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m464 [0m[2;33m│   │   [0m[33m"""[0m                                                                    [31m [0m
[31m [0m   [2m465 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m   [2m466 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m AsyncExitStack() [94mas[0m stack:                              [31m [0m
[31m [0m [31m❱ [0m467 [2m│   │   │   │   [0m[94mawait[0m stack.enter_async_context([96mself[0m._context_manager())       [31m [0m
[31m [0m   [2m468 [0m[2m│   │   │   │   [0m[2m# Session/context is now ready[0m                                 [31m [0m
[31m [0m   [2m469 [0m[2m│   │   │   │   [0m[96mself[0m._session_state.ready_event.set()                          [31m [0m
[31m [0m   [2m470 [0m[2m│   │   │   │   [0m[2m# Wait until disconnect/stop is requested[0m                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:668 in             [31m [0m
[31m [0m enter_async_context                                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m665 [0m[2m│   │   │   [0m[94mraise[0m [96mTypeError[0m([33mf[0m[33m"[0m[33m'[0m[33m{[0m[96mcls[0m.[91m__module__[0m[33m}[0m[33m.[0m[33m{[0m[96mcls[0m.[91m__qualname__[0m[33m}[0m[33m'[0m[33m object doe[0m [31m [0m
[31m [0m   [2m666 [0m[2m│   │   │   │   │   │   │   [0m[33mf[0m[33m"[0m[33mnot support the asynchronous context manager pro[0m [31m [0m
[31m [0m   [2m667 [0m[2m│   │   │   │   │   │      [0m) [94mfrom[0m[90m [0m[94mNone[0m                                         [31m [0m
[31m [0m [31m❱ [0m668 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m _enter(cm)[0m                                              [31m [0m
[31m [0m   [2m669 [0m[2m│   │   [0m[96mself[0m._push_async_cm_exit(cm, _exit)                                    [31m [0m
[31m [0m   [2m670 [0m[2m│   │   [0m[94mreturn[0m result                                                          [31m [0m
[31m [0m   [2m671 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:341 in _context_manager                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m338 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m339 [0m[2m│   [0m[1;95m@asynccontextmanager[0m                                                       [31m [0m
[31m [0m   [2m340 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m_context_manager[0m([96mself[0m):                                          [31m [0m
[31m [0m [31m❱ [0m341 [2m│   │   [0m[94mwith[0m [1;4mcatch(get_catch_handlers())[0m:                                      [31m [0m
[31m [0m   [2m342 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m [96mself[0m.transport.connect_session(                         [31m [0m
[31m [0m   [2m343 [0m[2m│   │   │   │   [0m**[96mself[0m._session_kwargs                                         [31m [0m
[31m [0m   [2m344 [0m[2m│   │   │   [0m) [94mas[0m session:                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:39 in __exit__                                                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 36 [0m[2m│   │   │   [0m[94melse[0m:                                                              [31m [0m
[31m [0m   [2m 37 [0m[2m│   │   │   │   [0m[94mif[0m [96misinstance[0m(exc, BaseExceptionGroup):                        [31m [0m
[31m [0m   [2m 38 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m 39 [2m│   │   │   │   │   │   [0m[94mraise[0m unhandled [94mfrom[0m[90m [0m[4;96mexc[0m[4;96m.[0m[4;96m__cause__[0m                     [31m [0m
[31m [0m   [2m 40 [0m[2m│   │   │   │   │   [0m[1;4;94mexcept[0m[1;4m BaseExceptionGroup:[0m                                 [31m [0m
[31m [0m   [2m 41 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# Change __context__ to __cause__ because Python 3.11 [0m [31m [0m
[31m [0m   [2m 42 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# too[0m                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:65 in handle_exception                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 62 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m   [2m 63 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m matched                                          [31m [0m
[31m [0m   [2m 64 [0m[2m│   │   │   │   │   [0m[94mexcept[0m BaseExceptionGroup:                                 [31m [0m
[31m [0m [31m❱ [0m 65 [2m│   │   │   │   │   │   [0mresult = handler(matched)                              [31m [0m
[31m [0m   [2m 66 [0m[2m│   │   │   │   [0m[94mexcept[0m BaseExceptionGroup [94mas[0m new_exc:                          [31m [0m
[31m [0m   [2m 67 [0m[2m│   │   │   │   │   [0m[94mif[0m new_exc [95mis[0m matched:                                     [31m [0m
[31m [0m   [2m 68 [0m[2m│   │   │   │   │   │   [0mnew_exceptions.append(new_exc)                         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/utilities/[0m [31m [0m
[31m [0m [1mexceptions.py[0m:29 in _exception_handler                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m26 [0m[2m│   │   │   │   │   [0mmessage=[33m"[0m[33mTimed out while waiting for response.[0m[33m"[0m,            [31m [0m
[31m [0m   [2m27 [0m[2m│   │   │   │   [0m)                                                               [31m [0m
[31m [0m   [2m28 [0m[2m│   │   │   [0m)                                                                   [31m [0m
[31m [0m [31m❱ [0m29 [2m│   │   [0m[1;4;94mraise[0m[1;4m leaf[0m                                                              [31m [0m
[31m [0m   [2m30 [0m                                                                                [31m [0m
[31m [0m   [2m31 [0m                                                                                [31m [0m
[31m [0m   [2m32 [0m[2m# this catch handler is used to catch taskgroup exception groups and raise the[0m  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:405 in handle_request_async                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m402 [0m[2m│   │   │   │   │   │   [0m[94mif[0m is_resumption:                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   │   [0m[94mawait[0m [96mself[0m._handle_resumption_request(ctx)         [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   │   [0m[94melse[0m:                                                  [31m [0m
[31m [0m [31m❱ [0m405 [2m│   │   │   │   │   │   │   [0m[1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._handle_post_request(ctx)[0m               [31m [0m
[31m [0m   [2m406 [0m[2m│   │   │   │   │   [0m                                                           [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   [0m[2m# If this is a request, start a new task to handle it[0m      [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(message.root, JSONRPCRequest):               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:259 in _handle_post_request                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m256 [0m[2m│   │   [0mmessage = ctx.session_message.message                                  [31m [0m
[31m [0m   [2m257 [0m[2m│   │   [0mis_initialization = [96mself[0m._is_initialization_request(message)           [31m [0m
[31m [0m   [2m258 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m259 [2m│   │   [0m[94masync[0m [94mwith[0m [1;4mctx.client.stream([0m                                          [31m [0m
[31m [0m   [2m260 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33mPOST[0m[1;4;33m"[0m[1;4m,[0m                                                            [31m [0m
[31m [0m   [2m261 [0m[2m│   │   │   [0m[1;4;96mself[0m[1;4m.url,[0m                                                          [31m [0m
[31m [0m   [2m262 [0m[2m│   │   │   [0m[1;4mjson=message.model_dump(by_alias=[0m[1;4;94mTrue[0m[1;4m, mode=[0m[1;4;33m"[0m[1;4;33mjson[0m[1;4;33m"[0m[1;4m, exclude_none=[0m[1;4;94mT[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 583 in stream                                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1580 [0m[2m│   │   │   [0mtimeout=timeout,                                                  [31m [0m
[31m [0m   [2m1581 [0m[2m│   │   │   [0mextensions=extensions,                                            [31m [0m
[31m [0m   [2m1582 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1583 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.send([0m                                           [31m [0m
[31m [0m   [2m1584 [0m[2m│   │   │   [0m[1;4mrequest=request,[0m                                                  [31m [0m
[31m [0m   [2m1585 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1586 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 629 in send                                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1626 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1627 [0m[2m│   │   [0mauth = [96mself[0m._build_request_auth(request, auth)                        [31m [0m
[31m [0m   [2m1628 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m1629 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_handling_auth([0m                            [31m [0m
[31m [0m   [2m1630 [0m[2m│   │   │   [0m[1;4mrequest,[0m                                                          [31m [0m
[31m [0m   [2m1631 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1632 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 657 in _send_handling_auth                                                           [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1654 [0m[2m│   │   │   [0mrequest = [94mawait[0m auth_flow.[92m__anext__[0m()                             [31m [0m
[31m [0m   [2m1655 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1656 [0m[2m│   │   │   [0m[94mwhile[0m [94mTrue[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m1657 [2m│   │   │   │   [0mresponse = [94mawait[0m [96mself[0m._send_handling_redirects(               [31m [0m
[31m [0m   [2m1658 [0m[2m│   │   │   │   │   [0mrequest,                                                  [31m [0m
[31m [0m   [2m1659 [0m[2m│   │   │   │   │   [0mfollow_redirects=follow_redirects,                        [31m [0m
[31m [0m   [2m1660 [0m[2m│   │   │   │   │   [0mhistory=history,                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 694 in _send_handling_redirects                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1691 [0m[2m│   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mrequest[0m[33m"[0m]:                         [31m [0m
[31m [0m   [2m1692 [0m[2m│   │   │   │   [0m[94mawait[0m hook(request)                                           [31m [0m
[31m [0m   [2m1693 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m [31m❱ [0m1694 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_single_request(request)[0m               [31m [0m
[31m [0m   [2m1695 [0m[2m│   │   │   [0m[94mtry[0m:                                                              [31m [0m
[31m [0m   [2m1696 [0m[2m│   │   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mresponse[0m[33m"[0m]:                    [31m [0m
[31m [0m   [2m1697 [0m[2m│   │   │   │   │   [0m[94mawait[0m hook(response)                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 730 in _send_single_request                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1727 [0m[2m│   │   │   [0m)                                                                 [31m [0m
[31m [0m   [2m1728 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1729 [0m[2m│   │   [0m[94mwith[0m request_context(request=request):                                [31m [0m
[31m [0m [31m❱ [0m1730 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m transport.handle_async_request(request)[0m          [31m [0m
[31m [0m   [2m1731 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1732 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(response.stream, AsyncByteStream)                   [31m [0m
[31m [0m   [2m1733 [0m[2m│   │   [0mresponse.request = request                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:393 in handle_async_request                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m390 [0m[2m│   │   │   [0mcontent=request.stream,                                            [31m [0m
[31m [0m   [2m391 [0m[2m│   │   │   [0mextensions=request.extensions,                                     [31m [0m
[31m [0m   [2m392 [0m[2m│   │   [0m)                                                                      [31m [0m
[31m [0m [31m❱ [0m393 [2m│   │   [0m[94mwith[0m [1;4mmap_httpcore_exceptions()[0m:                                        [31m [0m
[31m [0m   [2m394 [0m[2m│   │   │   [0mresp = [94mawait[0m [96mself[0m._pool.handle_async_request(req)                  [31m [0m
[31m [0m   [2m395 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m396 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(resp.stream, typing.AsyncIterable)                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:162 in __exit__    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m159 [0m[2m│   │   │   │   [0m[2m# tell if we get the same exception back[0m                       [31m [0m
[31m [0m   [2m160 [0m[2m│   │   │   │   [0mvalue = typ()                                                  [31m [0m
[31m [0m   [2m161 [0m[2m│   │   │   [0m[94mtry[0m:                                                               [31m [0m
[31m [0m [31m❱ [0m162 [2m│   │   │   │   [0m[96mself[0m.gen.throw(value)                                          [31m [0m
[31m [0m   [2m163 [0m[2m│   │   │   [0m[94mexcept[0m [96mStopIteration[0m [94mas[0m exc:                                       [31m [0m
[31m [0m   [2m164 [0m[2m│   │   │   │   [0m[2m# Suppress StopIteration *unless* it's the same exception that[0m [31m [0m
[31m [0m   [2m165 [0m[2m│   │   │   │   [0m[2m# was passed to throw().  This prevents a StopIteration[0m        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:118 in map_httpcore_exceptions                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   │   [0m[94mraise[0m                                                              [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0mmessage = [96mstr[0m(exc)                                                     [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   [0m[1;4;94mraise[0m[1;4m mapped_exc(message) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexc[0m                                     [31m [0m
[31m [0m   [2m119 [0m                                                                               [31m [0m
[31m [0m   [2m120 [0m                                                                               [31m [0m
[31m [0m   [2m121 [0m[94mclass[0m[90m [0m[4;92mResponseStream[0m(SyncByteStream):                                          [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mConnectError: [0mAll connection attempts failed

[3mThe above exception was the direct cause of the following exception:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:125 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m122 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m123 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpassword_entered[0m():                                                    [31m [0m
[31m [0m   [2m124 [0m[2;90m│   │   [0m[33m"""Checks whether a password entered by the user is correct."""[0m        [31m [0m
[31m [0m [31m❱ [0m125 [2m│   │   [0m[94mif[0m hmac.compare_digest(st.session_state[[33m"[0m[33mpassword[0m[33m"[0m], st.secrets[[33m"[0m[33mpassw[0m [31m [0m
[31m [0m   [2m126 [0m[2m│   │   │   [0mst.session_state[[33m"[0m[33mpassword_correct[0m[33m"[0m] = [94mTrue[0m                        [31m [0m
[31m [0m   [2m127 [0m[2m│   │   │   [0m[94mdel[0m st.session_state[[33m"[0m[33mpassword[0m[33m"[0m]  [2m# Don't store the password.[0m      [31m [0m
[31m [0m   [2m128 [0m[2m│   │   [0m[94melse[0m:                                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:362 in __aenter__                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m359 [0m[2m│   │   │   │   │   [0m[96mself[0m._session_state.initialize_result = [94mNone[0m               [31m [0m
[31m [0m   [2m360 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m361 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aenter__[0m([96mself[0m):                                                [31m [0m
[31m [0m [31m❱ [0m362 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._connect()[0m                                           [31m [0m
[31m [0m   [2m363 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m364 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aexit__[0m([96mself[0m, exc_type, exc_val, exc_tb):                      [31m [0m
[31m [0m   [2m365 [0m[2m│   │   [0m[94mawait[0m [96mself[0m._disconnect()                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:406 in _connect                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   [0m)                                                      [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(exception, httpx.HTTPStatusError):           [31m [0m
[31m [0m   [2m405 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m exception                                        [31m [0m
[31m [0m [31m❱ [0m406 [2m│   │   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m                                        [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   │   [0m[1;4;33mf[0m[1;4;33m"[0m[1;4;33mClient failed to connect: [0m[1;4;33m{[0m[1;4mexception[0m[1;4;33m}[0m[1;4;33m"[0m               [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexception[0m                                           [31m [0m
[31m [0m   [2m409 [0m                                                                               [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mClient failed to connect: All connection attempts failed

[3mDuring handling of the above exception, another exception occurred:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:187 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m184 [0m[2m│   │   │   │   [0mimage_caption = [94mTrue[0m                                           [31m [0m
[31m [0m   [2m185 [0m[2m│   │   │   [0m[94melif[0m upload_file_extension [95min[0m [[33m"[0m[33m.mp4[0m[33m"[0m, [33m"[0m[33m.mov[0m[33m"[0m]:                    [31m [0m
[31m [0m   [2m186 [0m[2m│   │   │   │   [0m[2m# Check if the uploaded file is a video[0m                        [31m [0m
[31m [0m [31m❱ [0m187 [2m│   │   │   [0m[1;2;4m│   [0m[1;4mvideo_bytes = upload[0m_files[[94m0[0m].getvalue()                       [31m [0m
[31m [0m   [2m188 [0m[2m│   │   │   │   [0m[94mwith[0m [96mopen[0m(video_file_name, [33m'[0m[33mwb[0m[33m'[0m) [94mas[0m f:                         [31m [0m
[31m [0m   [2m189 [0m[2m│   │   │   │   │   [0mf.write(video_bytes)                                       [31m [0m
[31m [0m   [2m190 [0m[2m│   │   │   │   [0mst.video(video_bytes)                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:130 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m127 [0m[2m│   │   │   [0m[94mdel[0m st.session_state[[33m"[0m[33mpassword[0m[33m"[0m]  [2m# Don't store the password.[0m      [31m [0m
[31m [0m   [2m128 [0m[2m│   │   [0m[94melse[0m:                                                                  [31m [0m
[31m [0m   [2m129 [0m[2m│   │   │   [0mst.session_state[[33m"[0m[33mpassword_correct[0m[33m"[0m] = [94mFalse[0m                       [31m [0m
[31m [0m [31m❱ [0m130 [2m│   [0m                                                                           [31m [0m
[31m [0m   [2m131 [0m[2m│   [0m[2m# Return True if the passward is validated.[0m                                [31m [0m
[31m [0m   [2m132 [0m[2m│   [0m[94mif[0m st.session_state.get([33m"[0m[33mpassword_correct[0m[33m"[0m, [94mFalse[0m):                        [31m [0m
[31m [0m   [2m133 [0m[2m│   │   [0m[94mreturn[0m [94mTrue[0m                                                            [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mEnsure master_mcp_server.py is running before starting the chatbot.
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:226 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0mresponse = st.session_state.openai_client.chat.completions.create(         [31m [0m
[31m [0m   [2m224 [0m[2m│   │   [0mmodel=MODEL_ID,                                                        [31m [0m
[31m [0m   [2m225 [0m[2m│   │   [0mmessages=st.session_state.messages,                                    [31m [0m
[31m [0m [31m❱ [0m226 [2m│   │   [0mmax_tok[1;4mens=max_tokens,[0m                                                 [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mtools=tools[0m                                                            [31m [0m
[31m [0m   [2m228 [0m[2m│   [0m[1;4m)[0m                                                                          [31m [0m
[31m [0m   [2m229 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRateLimitError: [0mError code: [1;36m429[0m - [1m{[0m[32m'detail'[0m: [32m'An error occurred [0m[32m([0m[32mThrottlingException[0m[32m)[0m[32m [0m
[32mwhen calling the Converse operation [0m[32m([0m[32mreached max retries: 1[0m[32m)[0m[32m: Too many tokens, please [0m
[32mwait before trying again.'[0m[1m}[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:237 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m234 [0m[2m│   [0mtool_calls = response.choices[[94m0[0m].message.tool_calls                        [31m [0m
[31m [0m   [2m235 [0m[2m│   [0m[94mif[0m tool_calls [95mis[0m [95mnot[0m [94mNone[0m [95mand[0m [96mlen[0m(tool_calls):                             [31m [0m
[31m [0m   [2m236 [0m[2m│   │   [0m[94mfor[0m tool [95min[0m tool_calls:                                                [31m [0m
[31m [0m [31m❱ [0m237 [2m│   │   │   [0mresult = [1;4masyncio.run(call_tool(tool))[0m                              [31m [0m
[31m [0m   [2m238 [0m[2m│   │   │   [0mst.session_state.messages.append({[33m"[0m[33mrole[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: resul [31m [0m
[31m [0m   [2m239 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m240 [0m[2m│   │   [0m[2m# Get next response from LLM[0m                                           [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:158 in call_tool              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m155 [0m[2m│   │   [0m[94melse[0m:                                                                  [31m [0m
[31m [0m   [2m156 [0m[2m│   │   │   [0margs = tool.function.arguments                                     [31m [0m
[31m [0m   [2m157 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m158 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m mcp_client.call_tool(tool.function.name, args)[0m            [31m [0m
[31m [0m   [2m159 [0m                                                                               [31m [0m
[31m [0m   [2m160 [0m                                                                               [31m [0m
[31m [0m   [2m161 [0m[2m# ----------------------------------------------------------------------------[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:866 in call_tool                                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m863 [0m[2m│   │   [0mdata = [94mNone[0m                                                            [31m [0m
[31m [0m   [2m864 [0m[2m│   │   [0m[94mif[0m result.isError [95mand[0m raise_on_error:                                  [31m [0m
[31m [0m   [2m865 [0m[2m│   │   │   [0mmsg = cast(mcp.types.TextContent, result.content[[94m0[0m]).text          [31m [0m
[31m [0m [31m❱ [0m866 [2m│   │   │   [0m[1;4;94mraise[0m[1;4m ToolError(msg)[0m                                               [31m [0m
[31m [0m   [2m867 [0m[2m│   │   [0m[94melif[0m result.structuredContent:                                         [31m [0m
[31m [0m   [2m868 [0m[2m│   │   │   [0m[94mtry[0m:                                                               [31m [0m
[31m [0m   [2m869 [0m[2m│   │   │   │   [0m[94mif[0m name [95mnot[0m [95min[0m [96mself[0m.session._tool_output_schemas:              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mToolError: [0mError calling tool [32m'access_sub_mcp'[0m: Recursion limit of [1;36m30[0m reached without 
hitting a stop condition. You can increase the limit by setting the `recursion_limit` 
config key.
For troubleshooting, visit: 
[4;94mhttps://python.langchain.com/docs/troubleshooting/errors/GRAPH_RECURSION_LIMIT[0m
Error reading SSE stream:
Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 213, in _receive_event
    with map_exceptions({h11.RemoteProtocolError: RemoteProtocolError}):
         ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/streamable_http.py", line 323, in _handle_sse_response
    async for sse in event_source.aiter_sse():
    ...<9 lines>...
            break
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx_sse/_api.py", line 42, in aiter_sse
    async for line in lines:
    ...<3 lines>...
            yield sse
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1031, in aiter_lines
    async for text in self.aiter_text():
        for line in decoder.decode(text):
            yield line
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1018, in aiter_text
    async for byte_content in self.aiter_bytes():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)
Error reading SSE stream:
Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 213, in _receive_event
    with map_exceptions({h11.RemoteProtocolError: RemoteProtocolError}):
         ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/streamable_http.py", line 323, in _handle_sse_response
    async for sse in event_source.aiter_sse():
    ...<9 lines>...
            break
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx_sse/_api.py", line 42, in aiter_sse
    async for line in lines:
    ...<3 lines>...
            yield sse
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1031, in aiter_lines
    async for text in self.aiter_text():
        for line in decoder.decode(text):
            yield line
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1018, in aiter_text
    async for byte_content in self.aiter_bytes():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)
Error reading SSE stream:
Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 101, in map_httpcore_exceptions
    yield
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 271, in __aiter__
    async for part in self._httpcore_stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 407, in __aiter__
    raise exc from None
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/connection_pool.py", line 403, in __aiter__
    async for part in self._stream:
        yield part
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 342, in __aiter__
    raise exc
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 334, in __aiter__
    async for chunk in self._connection._receive_response_body(**kwargs):
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 203, in _receive_response_body
    event = await self._receive_event(timeout=timeout)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_async/http11.py", line 213, in _receive_event
    with map_exceptions({h11.RemoteProtocolError: RemoteProtocolError}):
         ~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpcore/_exceptions.py", line 14, in map_exceptions
    raise to_exc(exc) from exc
httpcore.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/streamable_http.py", line 323, in _handle_sse_response
    async for sse in event_source.aiter_sse():
    ...<9 lines>...
            break
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx_sse/_api.py", line 42, in aiter_sse
    async for line in lines:
    ...<3 lines>...
            yield sse
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1031, in aiter_lines
    async for text in self.aiter_text():
        for line in decoder.decode(text):
            yield line
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1018, in aiter_text
    async for byte_content in self.aiter_bytes():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 997, in aiter_bytes
    async for raw_bytes in self.aiter_raw():
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_models.py", line 1055, in aiter_raw
    async for raw_stream_bytes in self.stream:
    ...<2 lines>...
            yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_client.py", line 176, in __aiter__
    async for chunk in self._stream:
        yield chunk
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 270, in __aiter__
    with map_httpcore_exceptions():
         ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/contextlib.py", line 162, in __exit__
    self.gen.throw(value)
    ~~~~~~~~~~~~~~^^^^^^^
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/default.py", line 118, in map_httpcore_exceptions
    raise mapped_exc(message) from exc
httpx.RemoteProtocolError: peer closed connection without sending complete message body (incomplete chunked read)
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:467 in _session_runner                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m464 [0m[2;33m│   │   [0m[33m"""[0m                                                                    [31m [0m
[31m [0m   [2m465 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m   [2m466 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m AsyncExitStack() [94mas[0m stack:                              [31m [0m
[31m [0m [31m❱ [0m467 [2m│   │   │   │   [0m[94mawait[0m stack.enter_async_context([96mself[0m._context_manager())       [31m [0m
[31m [0m   [2m468 [0m[2m│   │   │   │   [0m[2m# Session/context is now ready[0m                                 [31m [0m
[31m [0m   [2m469 [0m[2m│   │   │   │   [0m[96mself[0m._session_state.ready_event.set()                          [31m [0m
[31m [0m   [2m470 [0m[2m│   │   │   │   [0m[2m# Wait until disconnect/stop is requested[0m                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:668 in             [31m [0m
[31m [0m enter_async_context                                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m665 [0m[2m│   │   │   [0m[94mraise[0m [96mTypeError[0m([33mf[0m[33m"[0m[33m'[0m[33m{[0m[96mcls[0m.[91m__module__[0m[33m}[0m[33m.[0m[33m{[0m[96mcls[0m.[91m__qualname__[0m[33m}[0m[33m'[0m[33m object doe[0m [31m [0m
[31m [0m   [2m666 [0m[2m│   │   │   │   │   │   │   [0m[33mf[0m[33m"[0m[33mnot support the asynchronous context manager pro[0m [31m [0m
[31m [0m   [2m667 [0m[2m│   │   │   │   │   │      [0m) [94mfrom[0m[90m [0m[94mNone[0m                                         [31m [0m
[31m [0m [31m❱ [0m668 [2m│   │   [0mresult = [1;4;94mawait[0m[1;4m _enter(cm)[0m                                              [31m [0m
[31m [0m   [2m669 [0m[2m│   │   [0m[96mself[0m._push_async_cm_exit(cm, _exit)                                    [31m [0m
[31m [0m   [2m670 [0m[2m│   │   [0m[94mreturn[0m result                                                          [31m [0m
[31m [0m   [2m671 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:341 in _context_manager                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m338 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m339 [0m[2m│   [0m[1;95m@asynccontextmanager[0m                                                       [31m [0m
[31m [0m   [2m340 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m_context_manager[0m([96mself[0m):                                          [31m [0m
[31m [0m [31m❱ [0m341 [2m│   │   [0m[94mwith[0m [1;4mcatch(get_catch_handlers())[0m:                                      [31m [0m
[31m [0m   [2m342 [0m[2m│   │   │   [0m[94masync[0m [94mwith[0m [96mself[0m.transport.connect_session(                         [31m [0m
[31m [0m   [2m343 [0m[2m│   │   │   │   [0m**[96mself[0m._session_kwargs                                         [31m [0m
[31m [0m   [2m344 [0m[2m│   │   │   [0m) [94mas[0m session:                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:39 in __exit__                                                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 36 [0m[2m│   │   │   [0m[94melse[0m:                                                              [31m [0m
[31m [0m   [2m 37 [0m[2m│   │   │   │   [0m[94mif[0m [96misinstance[0m(exc, BaseExceptionGroup):                        [31m [0m
[31m [0m   [2m 38 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m 39 [2m│   │   │   │   │   │   [0m[94mraise[0m unhandled [94mfrom[0m[90m [0m[4;96mexc[0m[4;96m.[0m[4;96m__cause__[0m                     [31m [0m
[31m [0m   [2m 40 [0m[2m│   │   │   │   │   [0m[1;4;94mexcept[0m[1;4m BaseExceptionGroup:[0m                                 [31m [0m
[31m [0m   [2m 41 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# Change __context__ to __cause__ because Python 3.11 [0m [31m [0m
[31m [0m   [2m 42 [0m[2m│   │   │   │   │   │   [0m[1;2;4m# too[0m                                                  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/exceptiongroup/[0m[1m_ca[0m [31m [0m
[31m [0m [1mtch.py[0m:65 in handle_exception                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 62 [0m[2m│   │   │   │   │   [0m[94mtry[0m:                                                       [31m [0m
[31m [0m   [2m 63 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m matched                                          [31m [0m
[31m [0m   [2m 64 [0m[2m│   │   │   │   │   [0m[94mexcept[0m BaseExceptionGroup:                                 [31m [0m
[31m [0m [31m❱ [0m 65 [2m│   │   │   │   │   │   [0mresult = handler(matched)                              [31m [0m
[31m [0m   [2m 66 [0m[2m│   │   │   │   [0m[94mexcept[0m BaseExceptionGroup [94mas[0m new_exc:                          [31m [0m
[31m [0m   [2m 67 [0m[2m│   │   │   │   │   [0m[94mif[0m new_exc [95mis[0m matched:                                     [31m [0m
[31m [0m   [2m 68 [0m[2m│   │   │   │   │   │   [0mnew_exceptions.append(new_exc)                         [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/utilities/[0m [31m [0m
[31m [0m [1mexceptions.py[0m:29 in _exception_handler                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m26 [0m[2m│   │   │   │   │   [0mmessage=[33m"[0m[33mTimed out while waiting for response.[0m[33m"[0m,            [31m [0m
[31m [0m   [2m27 [0m[2m│   │   │   │   [0m)                                                               [31m [0m
[31m [0m   [2m28 [0m[2m│   │   │   [0m)                                                                   [31m [0m
[31m [0m [31m❱ [0m29 [2m│   │   [0m[1;4;94mraise[0m[1;4m leaf[0m                                                              [31m [0m
[31m [0m   [2m30 [0m                                                                                [31m [0m
[31m [0m   [2m31 [0m                                                                                [31m [0m
[31m [0m   [2m32 [0m[2m# this catch handler is used to catch taskgroup exception groups and raise the[0m  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:405 in handle_request_async                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m402 [0m[2m│   │   │   │   │   │   [0m[94mif[0m is_resumption:                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   │   [0m[94mawait[0m [96mself[0m._handle_resumption_request(ctx)         [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   │   [0m[94melse[0m:                                                  [31m [0m
[31m [0m [31m❱ [0m405 [2m│   │   │   │   │   │   │   [0m[1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._handle_post_request(ctx)[0m               [31m [0m
[31m [0m   [2m406 [0m[2m│   │   │   │   │   [0m                                                           [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   [0m[2m# If this is a request, start a new task to handle it[0m      [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(message.root, JSONRPCRequest):               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/mcp/client/[0m[1mstreama[0m [31m [0m
[31m [0m [1mble_http.py[0m:259 in _handle_post_request                                              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m256 [0m[2m│   │   [0mmessage = ctx.session_message.message                                  [31m [0m
[31m [0m   [2m257 [0m[2m│   │   [0mis_initialization = [96mself[0m._is_initialization_request(message)           [31m [0m
[31m [0m   [2m258 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m [31m❱ [0m259 [2m│   │   [0m[94masync[0m [94mwith[0m [1;4mctx.client.stream([0m                                          [31m [0m
[31m [0m   [2m260 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33mPOST[0m[1;4;33m"[0m[1;4m,[0m                                                            [31m [0m
[31m [0m   [2m261 [0m[2m│   │   │   [0m[1;4;96mself[0m[1;4m.url,[0m                                                          [31m [0m
[31m [0m   [2m262 [0m[2m│   │   │   [0m[1;4mjson=message.model_dump(by_alias=[0m[1;4;94mTrue[0m[1;4m, mode=[0m[1;4;33m"[0m[1;4;33mjson[0m[1;4;33m"[0m[1;4m, exclude_none=[0m[1;4;94mT[0m [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:214 in __aenter__  [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m211 [0m[2m│   │   [0m[2m# they are only needed for recreation, which is not possible anymore[0m   [31m [0m
[31m [0m   [2m212 [0m[2m│   │   [0m[94mdel[0m [96mself[0m.args, [96mself[0m.kwds, [96mself[0m.func                                    [31m [0m
[31m [0m   [2m213 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m214 [2m│   │   │   [0m[94mreturn[0m [94mawait[0m anext([96mself[0m.gen)                                       [31m [0m
[31m [0m   [2m215 [0m[2m│   │   [0m[1;4;94mexcept[0m[1;4m [0m[1;4;96mStopAsyncIteration[0m[1;4m:[0m                                             [31m [0m
[31m [0m   [2m216 [0m[2m│   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m"[0m[1;4;33mgenerator didn[0m[1;4;33m'[0m[1;4;33mt yield[0m[1;4;33m"[0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;94mNone[0m             [31m [0m
[31m [0m   [2m217 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 583 in stream                                                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1580 [0m[2m│   │   │   [0mtimeout=timeout,                                                  [31m [0m
[31m [0m   [2m1581 [0m[2m│   │   │   [0mextensions=extensions,                                            [31m [0m
[31m [0m   [2m1582 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1583 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m.send([0m                                           [31m [0m
[31m [0m   [2m1584 [0m[2m│   │   │   [0m[1;4mrequest=request,[0m                                                  [31m [0m
[31m [0m   [2m1585 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1586 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 629 in send                                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1626 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1627 [0m[2m│   │   [0mauth = [96mself[0m._build_request_auth(request, auth)                        [31m [0m
[31m [0m   [2m1628 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m1629 [2m│   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_handling_auth([0m                            [31m [0m
[31m [0m   [2m1630 [0m[2m│   │   │   [0m[1;4mrequest,[0m                                                          [31m [0m
[31m [0m   [2m1631 [0m[2m│   │   │   [0m[1;4mauth=auth,[0m                                                        [31m [0m
[31m [0m   [2m1632 [0m[2m│   │   │   [0m[1;4mfollow_redirects=follow_redirects,[0m                                [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 657 in _send_handling_auth                                                           [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1654 [0m[2m│   │   │   [0mrequest = [94mawait[0m auth_flow.[92m__anext__[0m()                             [31m [0m
[31m [0m   [2m1655 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1656 [0m[2m│   │   │   [0m[94mwhile[0m [94mTrue[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m1657 [2m│   │   │   │   [0mresponse = [94mawait[0m [96mself[0m._send_handling_redirects(               [31m [0m
[31m [0m   [2m1658 [0m[2m│   │   │   │   │   [0mrequest,                                                  [31m [0m
[31m [0m   [2m1659 [0m[2m│   │   │   │   │   [0mfollow_redirects=follow_redirects,                        [31m [0m
[31m [0m   [2m1660 [0m[2m│   │   │   │   │   [0mhistory=history,                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 694 in _send_handling_redirects                                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1691 [0m[2m│   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mrequest[0m[33m"[0m]:                         [31m [0m
[31m [0m   [2m1692 [0m[2m│   │   │   │   [0m[94mawait[0m hook(request)                                           [31m [0m
[31m [0m   [2m1693 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m [31m❱ [0m1694 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._send_single_request(request)[0m               [31m [0m
[31m [0m   [2m1695 [0m[2m│   │   │   [0m[94mtry[0m:                                                              [31m [0m
[31m [0m   [2m1696 [0m[2m│   │   │   │   [0m[94mfor[0m hook [95min[0m [96mself[0m._event_hooks[[33m"[0m[33mresponse[0m[33m"[0m]:                    [31m [0m
[31m [0m   [2m1697 [0m[2m│   │   │   │   │   [0m[94mawait[0m hook(response)                                      [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/[0m[1m_client.py[0m:1 [31m [0m
[31m [0m 730 in _send_single_request                                                          [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1727 [0m[2m│   │   │   [0m)                                                                 [31m [0m
[31m [0m   [2m1728 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1729 [0m[2m│   │   [0m[94mwith[0m request_context(request=request):                                [31m [0m
[31m [0m [31m❱ [0m1730 [2m│   │   │   [0mresponse = [1;4;94mawait[0m[1;4m transport.handle_async_request(request)[0m          [31m [0m
[31m [0m   [2m1731 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m   [2m1732 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(response.stream, AsyncByteStream)                   [31m [0m
[31m [0m   [2m1733 [0m[2m│   │   [0mresponse.request = request                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:393 in handle_async_request                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m390 [0m[2m│   │   │   [0mcontent=request.stream,                                            [31m [0m
[31m [0m   [2m391 [0m[2m│   │   │   [0mextensions=request.extensions,                                     [31m [0m
[31m [0m   [2m392 [0m[2m│   │   [0m)                                                                      [31m [0m
[31m [0m [31m❱ [0m393 [2m│   │   [0m[94mwith[0m [1;4mmap_httpcore_exceptions()[0m:                                        [31m [0m
[31m [0m   [2m394 [0m[2m│   │   │   [0mresp = [94mawait[0m [96mself[0m._pool.handle_async_request(req)                  [31m [0m
[31m [0m   [2m395 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m396 [0m[2m│   │   [0m[94massert[0m [96misinstance[0m(resp.stream, typing.AsyncIterable)                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/[0m[1mcontextlib.py[0m:162 in __exit__    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m159 [0m[2m│   │   │   │   [0m[2m# tell if we get the same exception back[0m                       [31m [0m
[31m [0m   [2m160 [0m[2m│   │   │   │   [0mvalue = typ()                                                  [31m [0m
[31m [0m   [2m161 [0m[2m│   │   │   [0m[94mtry[0m:                                                               [31m [0m
[31m [0m [31m❱ [0m162 [2m│   │   │   │   [0m[96mself[0m.gen.throw(value)                                          [31m [0m
[31m [0m   [2m163 [0m[2m│   │   │   [0m[94mexcept[0m [96mStopIteration[0m [94mas[0m exc:                                       [31m [0m
[31m [0m   [2m164 [0m[2m│   │   │   │   [0m[2m# Suppress StopIteration *unless* it's the same exception that[0m [31m [0m
[31m [0m   [2m165 [0m[2m│   │   │   │   [0m[2m# was passed to throw().  This prevents a StopIteration[0m        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/httpx/_transports/[0m [31m [0m
[31m [0m [1mdefault.py[0m:118 in map_httpcore_exceptions                                            [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   │   [0m[94mraise[0m                                                              [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0mmessage = [96mstr[0m(exc)                                                     [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   [0m[1;4;94mraise[0m[1;4m mapped_exc(message) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexc[0m                                     [31m [0m
[31m [0m   [2m119 [0m                                                                               [31m [0m
[31m [0m   [2m120 [0m                                                                               [31m [0m
[31m [0m   [2m121 [0m[94mclass[0m[90m [0m[4;92mResponseStream[0m(SyncByteStream):                                          [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mConnectError: [0mAll connection attempts failed

[3mThe above exception was the direct cause of the following exception:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:128 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m125 [0m[2m# Get tools[0m                                                                    [31m [0m
[31m [0m   [2m126 [0m[94masync[0m [94mdef[0m[90m [0m[92mget_tools[0m():                                                         [31m [0m
[31m [0m   [2m127 [0m[2m│   [0m[94mtry[0m:                                                                       [31m [0m
[31m [0m [31m❱ [0m128 [2m│   │   [0m[94masync[0m [94mwith[0m st.session_state.mcp_client [94mas[0m mcp_client:                  [31m [0m
[31m [0m   [2m129 [0m[2m│   │   │   [0mtools_list = [94mawait[0m mcp_client.list_tools()                         [31m [0m
[31m [0m   [2m130 [0m[2m│   │   │   [0m                                                                   [31m [0m
[31m [0m   [2m131 [0m[2m│   │   │   [0m[94mreturn[0m [96mlist[0m([96mmap[0m(tool_reformat, tools_list))                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:362 in __aenter__                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m359 [0m[2m│   │   │   │   │   [0m[96mself[0m._session_state.initialize_result = [94mNone[0m               [31m [0m
[31m [0m   [2m360 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m361 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aenter__[0m([96mself[0m):                                                [31m [0m
[31m [0m [31m❱ [0m362 [2m│   │   [0m[94mreturn[0m [1;4;94mawait[0m[1;4m [0m[1;4;96mself[0m[1;4m._connect()[0m                                           [31m [0m
[31m [0m   [2m363 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m364 [0m[2m│   [0m[94masync[0m [94mdef[0m[90m [0m[92m__aexit__[0m([96mself[0m, exc_type, exc_val, exc_tb):                      [31m [0m
[31m [0m   [2m365 [0m[2m│   │   [0m[94mawait[0m [96mself[0m._disconnect()                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/fastmcp/client/[0m[1mcli[0m [31m [0m
[31m [0m [1ment.py[0m:406 in _connect                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m403 [0m[2m│   │   │   │   │   │   [0m)                                                      [31m [0m
[31m [0m   [2m404 [0m[2m│   │   │   │   │   [0m[94mif[0m [96misinstance[0m(exception, httpx.HTTPStatusError):           [31m [0m
[31m [0m   [2m405 [0m[2m│   │   │   │   │   │   [0m[94mraise[0m exception                                        [31m [0m
[31m [0m [31m❱ [0m406 [2m│   │   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m                                        [31m [0m
[31m [0m   [2m407 [0m[2m│   │   │   │   │   │   [0m[1;4;33mf[0m[1;4;33m"[0m[1;4;33mClient failed to connect: [0m[1;4;33m{[0m[1;4mexception[0m[1;4;33m}[0m[1;4;33m"[0m               [31m [0m
[31m [0m   [2m408 [0m[2m│   │   │   │   │   [0m[1;4m) [0m[1;4;94mfrom[0m[1;4;90m [0m[1;4;96mexception[0m                                           [31m [0m
[31m [0m   [2m409 [0m                                                                               [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mClient failed to connect: All connection attempts failed

[3mDuring handling of the above exception, another exception occurred:[0m

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:190 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m187 [0m[2m│   │   [0mprompt = voice_prompt                                                  [31m [0m
[31m [0m   [2m188 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m189 [0m[2m│   [0m[2m# Get tools[0m                                                                [31m [0m
[31m [0m [31m❱ [0m190 [2m│   [0mtools = [1;4masyncio.run(get_tools())[0m                                           [31m [0m
[31m [0m   [2m191 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m192 [0m[2m│   [0m[2m# Add relevant files to message content[0m                                    [31m [0m
[31m [0m   [2m193 [0m[2m│   [0mmessage_content = []                                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:195 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m192 [0m[2m│   │   │   [0m[33m"[0m[33masyncio.run() cannot be called from a running event loop[0m[33m"[0m)        [31m [0m
[31m [0m   [2m193 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m194 [0m[2m│   [0m[94mwith[0m Runner(debug=debug, loop_factory=loop_factory) [94mas[0m runner:             [31m [0m
[31m [0m [31m❱ [0m195 [2m│   │   [0m[94mreturn[0m [1;4mrunner.run(main)[0m                                                [31m [0m
[31m [0m   [2m196 [0m                                                                               [31m [0m
[31m [0m   [2m197 [0m                                                                               [31m [0m
[31m [0m   [2m198 [0m[94mdef[0m[90m [0m[92m_cancel_all_tasks[0m(loop):                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mrunners.py[0m:118 in run    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m115 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m116 [0m[2m│   │   [0m[96mself[0m._interrupt_count = [94m0[0m                                              [31m [0m
[31m [0m   [2m117 [0m[2m│   │   [0m[94mtry[0m:                                                                   [31m [0m
[31m [0m [31m❱ [0m118 [2m│   │   │   [0m[94mreturn[0m [96mself[0m._loop.run_until_complete(task)                         [31m [0m
[31m [0m   [2m119 [0m[2m│   │   [0m[94mexcept[0m exceptions.CancelledError:                                      [31m [0m
[31m [0m   [2m120 [0m[2m│   │   │   [0m[94mif[0m [96mself[0m._interrupt_count > [94m0[0m:                                      [31m [0m
[31m [0m   [2m121 [0m[2m│   │   │   │   [0muncancel = [96mgetattr[0m(task, [33m"[0m[33muncancel[0m[33m"[0m, [94mNone[0m)                     [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/[0m[1mbase_events.py[0m:725 in    [31m [0m
[31m [0m run_until_complete                                                                   [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m 722 [0m[2m│   │   [0m[94mif[0m [95mnot[0m future.done():                                                 [31m [0m
[31m [0m   [2m 723 [0m[2m│   │   │   [0m[94mraise[0m [96mRuntimeError[0m([33m'[0m[33mEvent loop stopped before Future completed.[0m[33m'[0m) [31m [0m
[31m [0m   [2m 724 [0m[2m│   │   [0m                                                                      [31m [0m
[31m [0m [31m❱ [0m 725 [2m│   │   [0m[94mreturn[0m [1;4mfuture.result()[0m                                                [31m [0m
[31m [0m   [2m 726 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m 727 [0m[2m│   [0m[94mdef[0m[90m [0m[92mstop[0m([96mself[0m):                                                           [31m [0m
[31m [0m   [2m 728 [0m[2;90m│   │   [0m[33m"""Stop running the event loop.[0m                                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:133 in get_tools              [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m130 [0m[2m│   │   │   [0m                                                                   [31m [0m
[31m [0m   [2m131 [0m[2m│   │   │   [0m[94mreturn[0m [96mlist[0m([96mmap[0m(tool_reformat, tools_list))                        [31m [0m
[31m [0m   [2m132 [0m[2m│   [0m[94mexcept[0m [96mRuntimeError[0m:                                                       [31m [0m
[31m [0m [31m❱ [0m133 [2m│   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mRuntimeError[0m[1;4m([0m[1;4;33m'[0m[1;4;33mEnsure master_mcp_server.py is running before star[0m [31m [0m
[31m [0m   [2m134 [0m                                                                               [31m [0m
[31m [0m   [2m135 [0m                                                                               [31m [0m
[31m [0m   [2m136 [0m[2m# Reformat FastMCP tools to OpenAI standard[0m                                    [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mRuntimeError: [0mEnsure master_mcp_server.py is running before starting the chatbot.
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.session_state.displayed_messages.append({[33m"[0m[33mrole[0m[33m"[0m: [33m"[0m[33muser[0m[33m"[0m, [33m"[0m[33mcontent[0m[33m"[0m: pro [31m [0m
[31m [0m   [2m223 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0m[2m# Generate [0m[1;2;4mresponse[0m                                                        [31m [0m
[31m [0m   [2m226 [0m[2m│   [0m[1;4mresponse = st.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0mresponse = [1;4mst.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m226 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmax_tokens=max_tokens,[0m                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0mresponse = [1;4mst.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m226 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmax_tokens=max_tokens,[0m                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0mresponse = [1;4mst.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m226 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmax_tokens=max_tokens,[0m                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
  Stopping...

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.

2025-08-10 22:49:14.537 Port 7868 is already in use
  Stopping...
Traceback (most recent call last):
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/web/bootstrap.py", line 43, in signal_handler
    server.stop()
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/web/server/server.py", line 509, in stop
    self._runtime.stop()
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/runtime.py", line 329, in stop
    async_objs.eventloop.call_soon_threadsafe(stop_on_eventloop)
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/base_events.py", line 878, in call_soon_threadsafe
    self._check_closed()
  File "/home/aaron/.conda/envs/firstaid-new/lib/python3.13/asyncio/base_events.py", line 556, in _check_closed
    raise RuntimeError('Event loop is closed')
RuntimeError: Event loop is closed

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: http://localhost:7868
  Network URL: http://172.31.11.95:7868
  External URL: http://44.229.65.238:7868

  Stopping...
2025-08-10 22:57:26.189 "server.password" is not a valid config option. If you previously had this config option set, it may have been removed.

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: https://localhost:7868
  Network URL: https://172.31.11.95:7868
  External URL: https://44.229.65.238:7868

  Stopping...
2025-08-10 22:59:06.687 "server.password" is not a valid config option. If you previously had this config option set, it may have been removed.

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: https://localhost:7868
  Network URL: https://172.31.11.95:7868
  External URL: https://44.229.65.238:7868

  Stopping...
2025-08-10 23:02:17.732 "server.password" is not a valid config option. If you previously had this config option set, it may have been removed.

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: https://localhost:7868
  Network URL: https://172.31.11.95:7868
  External URL: https://44.229.65.238:7868

2025-08-10 23:06:15.142 "server.password" is not a valid config option. If you previously had this config option set, it may have been removed.
  Stopping...
2025-08-10 23:07:25.612 "server.password" is not a valid config option. If you previously had this config option set, it may have been removed.

Collecting usage statistics. To deactivate, set browser.gatherUsageStats to false.


  You can now view your Streamlit app in your browser.

  Local URL: https://localhost:7868
  Network URL: https://172.31.11.95:7868
  External URL: https://44.229.65.238:7868

[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0mresponse = [1;4mst.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m226 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmax_tokens=max_tokens,[0m                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
[31m──[0m[31m────────────────────────[0m[31m [0m[1;31mTraceback [0m[1;2;31m(most recent call last)[0m[31m [0m[31m─────────────────────────[0m[31m──[0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mexec_code.py[0m:128 in exec_func_with_error_handling                       [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/streamlit/runtime/[0m [31m [0m
[31m [0m [2mscriptrunner/[0m[1mscript_runner.py[0m:669 in code_to_exec                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/src/first-aid/demo/heartbit-ai/src/[0m[1mhome.py[0m:225 in <module>               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m222 [0m[2m│   [0mst.chat_message([33m"[0m[33muser[0m[33m"[0m).write(prompt)                                      [31m [0m
[31m [0m   [2m223 [0m[2m│   [0m                                                                           [31m [0m
[31m [0m   [2m224 [0m[2m│   [0m[2m# Generate response[0m                                                        [31m [0m
[31m [0m [31m❱ [0m225 [2m│   [0mresponse = [1;4mst.session_state.openai_client.chat.completions.create([0m         [31m [0m
[31m [0m   [2m226 [0m[2m│   │   [0m[1;4mmodel=MODEL_ID,[0m                                                        [31m [0m
[31m [0m   [2m227 [0m[2m│   │   [0m[1;4mmessages=st.session_state.messages,[0m                                    [31m [0m
[31m [0m   [2m228 [0m[2m│   │   [0m[1;4mmax_tokens=max_tokens,[0m                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/_utils/[0m[1m_uti[0m [31m [0m
[31m [0m [1mls.py[0m:287 in wrapper                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m284 [0m[2m│   │   │   │   │   [0m[94melse[0m:                                                      [31m [0m
[31m [0m   [2m285 [0m[2m│   │   │   │   │   │   [0mmsg = [33mf[0m[33m"[0m[33mMissing required argument: [0m[33m{[0mquote(missing[[94m0[0m])[33m}[0m [31m [0m
[31m [0m   [2m286 [0m[2m│   │   │   │   [0m[94mraise[0m [96mTypeError[0m(msg)                                           [31m [0m
[31m [0m [31m❱ [0m287 [2m│   │   │   [0m[94mreturn[0m [1;4mfunc(*args, **kwargs)[0m                                       [31m [0m
[31m [0m   [2m288 [0m[2m│   │   [0m                                                                       [31m [0m
[31m [0m   [2m289 [0m[2m│   │   [0m[94mreturn[0m wrapper  [2m# type: ignore[0m                                         [31m [0m
[31m [0m   [2m290 [0m                                                                               [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/resources/c[0m [31m [0m
[31m [0m [2mhat/completions/[0m[1mcompletions.py[0m:1131 in create                                        [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1128 [0m[2m│   │   [0mtimeout: [96mfloat[0m | httpx.Timeout | [94mNone[0m | NotGiven = NOT_GIVEN,         [31m [0m
[31m [0m   [2m1129 [0m[2m│   [0m) -> ChatCompletion | Stream[ChatCompletionChunk]:                        [31m [0m
[31m [0m   [2m1130 [0m[2m│   │   [0mvalidate_response_format(response_format)                             [31m [0m
[31m [0m [31m❱ [0m1131 [2m│   │   [0m[94mreturn[0m [1;4;96mself[0m[1;4m._post([0m                                                    [31m [0m
[31m [0m   [2m1132 [0m[2m│   │   │   [0m[1;4;33m"[0m[1;4;33m/chat/completions[0m[1;4;33m"[0m[1;4m,[0m                                              [31m [0m
[31m [0m   [2m1133 [0m[2m│   │   │   [0m[1;4mbody=maybe_transform([0m                                             [31m [0m
[31m [0m   [2m1134 [0m[2m│   │   │   │   [0m[1;4m{[0m                                                             [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1256 in post                                                                    [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1253 [0m[2m│   │   [0mopts = FinalRequestOptions.construct(                                 [31m [0m
[31m [0m   [2m1254 [0m[2m│   │   │   [0mmethod=[33m"[0m[33mpost[0m[33m"[0m, url=path, json_data=body, files=to_httpx_files(fil [31m [0m
[31m [0m   [2m1255 [0m[2m│   │   [0m)                                                                     [31m [0m
[31m [0m [31m❱ [0m1256 [2m│   │   [0m[94mreturn[0m cast(ResponseT, [1;4;96mself[0m[1;4m.request(cast_to, opts, stream=stream, str[0m [31m [0m
[31m [0m   [2m1257 [0m[2m│   [0m                                                                          [31m [0m
[31m [0m   [2m1258 [0m[2m│   [0m[94mdef[0m[90m [0m[92mpatch[0m(                                                                [31m [0m
[31m [0m   [2m1259 [0m[2m│   │   [0m[96mself[0m,                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m [2m/home/aaron/.conda/envs/firstaid-new/lib/python3.13/site-packages/openai/[0m[1m_base_clien[0m [31m [0m
[31m [0m [1mt.py[0m:1044 in request                                                                 [31m [0m
[31m [0m                                                                                      [31m [0m
[31m [0m   [2m1041 [0m[2m│   │   │   │   │   [0merr.response.read()                                       [31m [0m
[31m [0m   [2m1042 [0m[2m│   │   │   │   [0m                                                              [31m [0m
[31m [0m   [2m1043 [0m[2m│   │   │   │   [0mlog.debug([33m"[0m[33mRe-raising status error[0m[33m"[0m)                          [31m [0m
[31m [0m [31m❱ [0m1044 [2m│   │   │   │   [0m[1;4;94mraise[0m[1;4m [0m[1;4;96mself[0m[1;4m._make_status_error_from_response(err.response) [0m[1;4;94mfro[0m [31m [0m
[31m [0m   [2m1045 [0m[2m│   │   │   [0m                                                                  [31m [0m
[31m [0m   [2m1046 [0m[2m│   │   │   [0m[94mbreak[0m                                                             [31m [0m
[31m [0m   [2m1047 [0m                                                                              [31m [0m
[31m────────────────────────────────────────────────────────────────────────────────────────[0m
[1;91mAPIStatusError: [0m[1m<[0m[1;95mhtml[0m[39m>[0m
[39m<head><title>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mtitle[0m[39m><[0m[35m/[0m[95mhead[0m[39m>[0m
[39m<body>[0m
[39m<center><h1>[0m[1;36m413[0m[39m Request Entity Too Large<[0m[35m/[0m[95mh1[0m[39m><[0m[35m/[0m[95mcenter[0m[39m>[0m
[39m<[0m[35m/[0m[95mbody[0m[39m>[0m
[39m<[0m[35m/[0m[95mhtml[0m[1m>[0m
